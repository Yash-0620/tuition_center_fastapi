<!DOCTYPE html>
<html>
<head>
    <title>Test Records - {{ student.name }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container mt-4">

    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3>Tests â€” {{ student.name }}</h3>
        <div class="d-flex gap-2">
            <a href="/student/{{ student.id }}/generate-questions" class="btn btn-primary">Generate Questions</a>
            <a href="/dashboard" class="btn btn-secondary">Back to Dashboard</a>
        </div>
    </div>

    <!-- Add Test Form -->
    <div class="card mb-4">
        <div class="card-header bg-primary text-white">
            Add Test Record
        </div>
        <div class="card-body">
            <form method="post" action="/student/{{ student.id }}/tests/add" class="row g-3">
                <div class="col-md-3">
                    <label class="form-label">Subject</label>
                    <input type="text" name="subject" class="form-control" required>
                </div>
                <div class="col-md-3">
                    <label class="form-label">Topic</label>
                    <input type="text" name="topic" class="form-control" required>
                </div>
                <div class="col-md-3">
                    <label class="form-label">Date</label>
                    <input type="date" name="test_date" class="form-control" required>
                </div>
                <div class="col-md-3">
                    <label class="form-label">Total Marks</label>
                    <input type="number" name="total_marks" min="0" class="form-control" required>
                </div>
                <div class="col-md-3">
                    <label class="form-label">Marks Attained</label>
                    <input type="number" name="marks_attained" min="0" class="form-control" required>
                </div>
                <div class="col-md-8">
                    <label class="form-label">Remarks</label>
                    <input type="text" name="remarks" class="form-control" required>
                </div>
                <div class="col-12">
                    <button type="submit" class="btn btn-success">Add Test</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Test Records Table -->
    {% if tests %}
    <div class="card">
        <div class="card-header bg-info text-white">
            Test Records
        </div>
        <div class="card-body p-0">
            <table class="table table-bordered table-striped mb-0">
                <thead class="table-light">
                    <tr>
                        <th>Subject</th>
                        <th>Topic</th>
                        <th>Date</th>
                        <th>Total Marks</th>
                        <th>Marks Attained</th>
                        <th>Percentage</th>
                        <th>Remarks</th>
                    </tr>
                </thead>
                <tbody>
                    {% for test in tests %}
                    {% set percentage = (test.marks_attained / test.total_marks * 100) if test.total_marks > 0 else 0 %}
                    {% if percentage >= 75 %}
                        {% set row_class = "table-success" %}
                    {% elif percentage >= 50 %}
                        {% set row_class = "table-warning" %}
                    {% else %}
                        {% set row_class = "table-danger" %}
                    {% endif %}
                    <tr class="{{ row_class }}">
                        <td>{{ test.subject }}</td>
                        <td>{{ test.topic }}</td>
                        <td>{{ test.test_date.strftime("%d-%m-%Y") }}</td>
                        <td>{{ test.total_marks }}</td>
                        <td>{{ test.marks_attained }}</td>
                        <td>{{ percentage|round(2) }}%</td>
                        <td>{{ test.remarks }}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% else %}
        <p class="text-muted">No test records found for this student.</p>
    {% endif %}

</div>
</body>
</html>
